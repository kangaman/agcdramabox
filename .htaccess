##############################################
# BALANCED SECURITY .HTACCESS (OPTIMIZED)
# Safe for Streaming & Dashboard
##############################################

<IfModule mod_rewrite.c>
    RewriteEngine On

    # ===============================
    # 1. FORCE HTTPS (Wajib Gembok Hijau)
    # ===============================
    RewriteCond %{HTTPS} !=on
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # ===============================
    # 2. ROUTING URL
    # ===============================
    # Halaman Utama & Pencarian
    RewriteRule ^cari/(.*)$ index.php?page=search&q=$1 [L,QSA]
    
    # Halaman Nonton
    RewriteRule ^nonton/(.*)$ index.php?page=watch&id=$1 [L,QSA]
    RewriteRule ^watch$ index.php?page=watch [L,QSA] 

    # Halaman Statis & Auth
    RewriteRule ^terms$ index.php?page=terms [L,QSA]
    RewriteRule ^privacy$ index.php?page=privacy [L,QSA]
    RewriteRule ^login$ index.php?page=login [L,QSA]
    RewriteRule ^register$ index.php?page=register [L,QSA]
    RewriteRule ^logout$ index.php?page=logout [L,QSA]

    # Dashboard Routing
    RewriteRule ^dashboard$ index.php?page=dashboard/overview [L,QSA]
    RewriteRule ^dashboard/(.*)$ index.php?page=dashboard/$1 [L,QSA]

    # ===============================
    # 3. PROTECTION (Blokir Akses Folder Sistem)
    # ===============================
    RewriteRule ^app/(.*)$ - [F,L]
    RewriteRule ^views/(.*)$ - [F,L]
    
    # Blokir akses langsung ke file PHP sensitif selain index.php
    RewriteCond %{REQUEST_FILENAME} !index.php
    RewriteRule \.php$ - [F,L]

</IfModule>

# ===============================
# 4. CACHING CONTROL (1 HARI / 24 JAM)
# ===============================
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Gambar (Set 1 Hari agar loading cepat)
    ExpiresByType image/jpg "access plus 1 day"
    ExpiresByType image/jpeg "access plus 1 day"
    ExpiresByType image/gif "access plus 1 day"
    ExpiresByType image/png "access plus 1 day"
    ExpiresByType image/webp "access plus 1 day"
    ExpiresByType image/x-icon "access plus 1 day"
    
    # CSS & JavaScript (Set 1 Hari)
    # Browser akan menyimpan file ini selama 24 jam.
    # Setelah 24 jam, browser otomatis cek versi baru ke server.
    ExpiresByType text/css "access plus 1 day"
    ExpiresByType text/javascript "access plus 1 day"
    ExpiresByType application/javascript "access plus 1 day"
    
    # Default (Untuk file lain)
    ExpiresDefault "access plus 1 day"
</IfModule>

# ===============================
# 5. SECURITY HEADERS & COMPRESSION
# ===============================
<IfModule mod_headers.c>
    # Izin akses untuk Font, Script, dan Gambar (Termasuk CDN)
    Header always set Content-Security-Policy "default-src 'self'; img-src 'self' data: https:; media-src 'self' https: blob: data:; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://code.jquery.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net https://cdn.datatables.net; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net data:; object-src 'none'; frame-ancestors 'self'; base-uri 'self';"
    
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
</IfModule>

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript
</IfModule>
